---
title: "hwk6_aar2192"
author: "Amadeia Rector"
date: "11/20/2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

library(tidyverse)
library(purrr)

theme_set(theme_bw() + theme(legend.position = "bottom"))
```

# Problem 1  
This problem uses the dataset on homicides given by the Washington Post.

### Part a
Create a city_state variable (e.g. “Baltimore, MD”), and a binary variable indicating whether the homicide is solved. Omit cities Dallas, TX; Phoenix, AZ; and Kansas City, MO – these don’t report victim race. Also omit Tulsa, AL – this is a data entry mistake. Modifiy victim_race to have categories white and non-white, with white as the reference category. Be sure that victim_age is numeric.


```{r}
homicide_df = 
  read_csv("data/homicide-data.csv", na = c("", "NA", "Unknown")) %>%
  mutate(
    city_state = str_c(city, state, sep = ", "),
    resolution = case_when(
      disposition == "Closed without arrest" ~ "unresolved",
      disposition == "Open/No arrest"        ~ "unresolved",
      disposition == "Closed by arrest"      ~ "resolved"
    )
  ) %>% 
  filter(city_state != "Tulsa, AL") %>% 
  filter(city_state != "Dallas, TX") %>% 
  filter(city_state != "Phoenix, AZ") %>% 
  filter(city_state != "Kansas City, MO") %>% 
  filter(victim_race != is.na(victim_race)) %>% 
  mutate(victim_race = ifelse(victim_race %in% "White", "white", "non-white"),
         victim_race = fct_relevel(victim_race, "white"),
         victim_age = as.numeric(victim_age))
```

### Part b  
For the city of Baltimore, MD, use the glm function to fit a logistic regression with resolved vs unresolved as the outcome and victim age, sex and race (as just defined) as predictors. Save the output of glm as an R object; apply the broom::tidy to this object; and obtain the estimate and confidence interval of the adjusted odds ratio for solving homicides comparing non-white victims to white victims keeping all other variables fixed.

```{r}
fit_logistic_balt =
  homicide_df %>% 
  mutate(resolved = as.numeric(resolution == "resolved")) %>% 
  filter(city == "Baltimore") %>% 
  glm(resolved ~ victim_age + victim_race + victim_sex, data = ., family = binomial())

fit_logistic_balt %>% 
  broom::tidy() %>% 
  mutate(CI_lower = estimate - 1.96*std.error,
         CI_upper = estimate + 1.96*std.error,
         OR = exp(estimate),
         CI_lower = exp(CI_lower),
         CI_upper = exp(CI_upper)) %>%
  select(term, log_OR = estimate, OR, CI_lower, CI_upper, p.value) %>% 
  knitr::kable(digits = 3)
```



